<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
  <title>Arduino HAP</title>

  <script>
    strRELAY1 = "";
    strRELAY2 = "";
    strRELAY3 = "";
    strRELAY4 = "";
    strRELAY5 = "";
    var RELAY1_state = 0;
    var RELAY2_state = 0;
    var RELAY3_state = 0;
    var RELAY4_state = 0;
    var RELAY5_state = 0;
    function GetArduinoIO() {
      nocache = "&nocache=" + Math.random() * 10000;
      var request = new XMLHttpRequest();
      request.onreadystatechange = function() {
        if (this.readyState == 4) {
          if (this.status == 200) {
            if (this.responseXML != null) {
                // XML file received

                // Temperature
                document.getElementById("celsius").innerHTML = this.responseXML.getElementsByTagName('temp')[0].childNodes[0].nodeValue;

                // RELAY 1
                if (this.responseXML.getElementsByTagName('RELAY')[0].childNodes[0].nodeValue === "on") {
                  document.getElementById("RELAY1").innerHTML = "ON";
                  RELAY1_state = 1;
                }
                else {
                  document.getElementById("RELAY1").innerHTML = "OFF";
                  RELAY1_state = 0;
                }
                // RELAY 2
                if (this.responseXML.getElementsByTagName('RELAY')[1].childNodes[0].nodeValue === "on") {
                  document.getElementById("RELAY2").innerHTML = "ON";
                  RELAY2_state = 1;
                }
                else {
                  document.getElementById("RELAY2").innerHTML = "OFF";
                  RELAY2_state = 0;
                }
                // RELAY 3
                if (this.responseXML.getElementsByTagName('RELAY')[2].childNodes[0].nodeValue === "on") {
                  document.getElementById("RELAY3").innerHTML = "ON";
                  RELAY3_state = 1;
                }
                else {
                  document.getElementById("RELAY3").innerHTML = "OFF";
                  RELAY3_state = 0;
                }
                // RELAY 4
                if (this.responseXML.getElementsByTagName('RELAY')[3].childNodes[0].nodeValue === "on") {
                  document.getElementById("RELAY4").innerHTML = "ON";
                  RELAY4_state = 1;
                }
                else {
                  document.getElementById("RELAY4").innerHTML = "OFF";
                  RELAY4_state = 0;
                }
                // RELAY 5
                if (this.responseXML.getElementsByTagName('RELAY')[4].childNodes[0].nodeValue === "on") {
                  document.getElementById("RELAY5").innerHTML = "ON";
                  RELAY5_state = 1;
                }
                else {
                  document.getElementById("RELAY5").innerHTML = "OFF";
                  RELAY5_state = 0;
                }
              }
            }
          }
        }
        // send HTTP GET request with RELAYs to switch on/off if any
        request.open("GET", "button_state" + strRELAY1 + strRELAY2 + strRELAY3 + strRELAY4 + strRELAY5 + nocache, true);
        request.send(null);
        setTimeout('GetArduinoIO()', 800);
        strRELAY1 = "";
        strRELAY2 = "";
        strRELAY3 = "";
        strRELAY4 = "";
        strRELAY5 = "";
      }

      function GetButton1() {
        if (RELAY1_state === 1) {
          RELAY1_state = 0;
          strRELAY1 = "&RELAY1=0";
        }
        else {
          RELAY1_state = 1;
          strRELAY1 = "&RELAY1=1";
        }
      }
      function GetButton2() {
        if (RELAY2_state === 1) {
          RELAY2_state = 0;
          strRELAY2 = "&RELAY2=0";
        }
        else {
          RELAY2_state = 1;
          strRELAY2 = "&RELAY2=1";
        }
      }
      function GetButton3() {
        if (RELAY3_state === 1) {
          RELAY3_state = 0;
          strRELAY3 = "&RELAY3=0";
        }
        else {
          RELAY3_state = 1;
          strRELAY3 = "&RELAY3=1";
        }
      }
      function GetButton4() {
        if (RELAY4_state === 1) {
          RELAY4_state = 0;
          strRELAY4 = "&RELAY4=0";
        }
        else {
          RELAY4_state = 1;
          strRELAY4 = "&RELAY4=1";
        }
      }
      function GetButton5() {
        if (RELAY5_state === 1) {
          RELAY5_state = 0;
          strRELAY5 = "&RELAY5=0";
        }
        else {
          RELAY5_state = 1;
          strRELAY5 = "&RELAY5=1";
        }
      }
    </script>

    <style type="text/css">
      body {
        background-color: #333333;
      }
      .temperature {
        font-family: Tahoma, Geneva, sans-serif;
        border: #999 5px inset;
        margin: 0 15px 0;
        padding: 4px;
        position: fixed;
        display: inline;
        text-align: center;
        top: 2px;
        left: auto;
        right: auto;
        bottom: auto;
      }
      .temperature p {
        font-size: 16px;
        font-weight: normal;
        color: #096;
        display: inline;
      }
      .temperature temp span {
        color: #999;
        font-size: 20px;
        text-align: left;
        width: 100%;
        display: inline;
      }
      .temperature temp sup {
        color: #FF9900;
        font-size: 10px;
        font-weight: bold;
        text-align: left;
      }
      .clockStyle {
        font-family: Tahoma, Geneva, sans-serif;
        font-size: 15px;
        font-weight: bold;
        letter-spacing: 3px;
        border: #999 5px inset;
        margin: 0px 15px 0;
        padding: 7px;
        color: #009933;
        display: inline;
        top: 2px;
        position: fixed;
        right: 0%;
      }
      .IO_box {
        border: 4px solid #096;
        border-radius: 25px;
        padding: 5px 10px;
        margin-left: auto;
        margin-right: auto;
        width: 230px;
        background-color: #333;
        -webkit-box-shadow: 10px 10px 5px 0px rgba(0,0,0,0.75);
        -moz-box-shadow: 10px 10px 5px 0px rgba(0,0,0,0.75);
        box-shadow: 10px 10px 5px 0px rgba(0,0,0,0.75);
        text-align: right;
      }
      .IO_box p {
        font-family: Georgia, "Times New Roman", Times, serif;
        color: #3F9;
        margin: 1% 1% 0;
        font-size: 18px;
        float: left;
      }

      h1 {
        text-align: center;
        font-size: 30px;
        color: #FFF;
        margin: 50px auto 2% auto;
        background-color: #333;
        font-family: Tahoma, Geneva, sans-serif;
        border-radius: 10px;
        padding: 10px;
      }
      h2 {
        text-align: center;
        color: #33FF66;
        margin-top: 4%;
        font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        font-size: 20px;
      }
      button {
        font-family: helvetica;
        color: #333 !important;
        font-size: 14px;
        box-shadow: 1px 1px 1px #BEE2F9;
        padding: 10px 25px;
        border-radius: 10px;
        -moz-border-radius: 10px;
        -webkit-border-radius: 10px;
        background: #63B8EE;
        background: linear-gradient(top, #83B8EE, #468CCF);
        background: -ms-linear-gradient(top, #63B8EE, #468CCF);
        background: -webkit-gradient(linear, left top, left bottom, from(#63B8EE), to(#468CCF));
        background: -moz-linear-gradient(top, #63B8EE, #468CCF);
        border: 3px solid #333;
        margin: 0 0 10px;
      }

      button:hover {
        color: #14396A !important;
        background: #468CCF;
        cursor: pointer;
        background: linear-gradient(top, #468CCF, #63B8EE);
        background: -ms-linear-gradient(top, #468CCF, #63B8EE);
        background: -webkit-gradient(linear, left top, left bottom, from(#468CCF), to(#63B8EE));
        background: -moz-linear-gradient(top, #468CCF, #63B8EE);
      }
    </style>
  </head>

  <body onload="GetArduinoIO()">

    <div id="clockDisplay" class="clockStyle"></div>
    <!-- script for clock  -->
    <script type="text/javascript" language="javascript">
    function renderTime() {
        var currentTime  = new Date();
        var diem = 'AM';
        var h    = currentTime.getHours();
        var m    = currentTime.getMinutes();
        var s    = currentTime.getSeconds();


        if  (h == 0) {
              h = 12;
        }
        else if (h > 12) {
              h = h - 12
              diem = 'PM';
        }
        if (h < 10) {
            h = '0' + h;
        }

        if (m < 10) {
            m = '0' + m;
        }
        if (s < 10) {
            s = '0' + s;
        }
        var myClock = document.getElementById('clockDisplay');
        myClock.textContent = h + ':' + m + ':' + s + ' ' + diem;
        myClock.innerText   = h + ':' + m + ':' + s + ' ' + diem;
        setTimeout('renderTime()',1000);

      }
      renderTime();
    </script>

    <div class="temperature">
      <temp>
        <p> Home Temperature: </p>
        <span id="celsius">...</span>
        <sup id="deg">&deg;C</sup>
      </temp>
    </div>

    <h1>Arduino Home Automation Panel</h1>

    <div class="IO_box">
      <h2>Lights</h2>
      <p>Living Room</p>
      <button type="button" id="RELAY1" onclick="GetButton1()">OFF</button><br>
      <p>Master Bed</p>
      <button type="button" id="RELAY2" onclick="GetButton2()">OFF</button><br>
      <p>Guest Room</p>
      <button type="button" id="RELAY3" onclick="GetButton3()">OFF</button><br>
      <p>Kitchen</p>
      <button type="button" id="RELAY4" onclick="GetButton4()">OFF</button><br>
      <p>Wash Room</p>
      <button type="button" id="RELAY5" onclick="GetButton5()">OFF</button><br>
    </div>

  </body>
</html>
